<!DOCTYPE html>
<html>

<head>
    <title>IFRAME - SGX</title>
    <script type="text/javascript" src="../javascripts/vendor/jquery-modern/jquery.js"></script>		
    <script type="text/javascript">

    $(document).ready(function() {

    	$.ajax({
            url: "companies.json",
            type: 'GET',
            dataType: 'json',
            scriptCharset: "utf-8" , 
            contentType: 'application/json; charset=UTF-8',           	
            success: finished,
            error: error
    	});

    })
    
    
	function finished(data) {
    	
    	var fields = [ "avgBrokerReq",
    	               "beta5Yr",
    	               "dividendYield",
    	               "ebitdaMargin",
    	               "eps",
    	               "marketCap",
    	               "netProfitMargin",
    	               "peRatio",
    	               "priceToBookRatio",
    	               "priceVs52WeekHigh",
    	               "priceVs52WeekLow",
    	               "targetPriceNum",
    	               "totalDebtEquity",
    	               "totalRev1YrAnnGrowth",
    	               "totalRev3YrAnnGrowth",
    	               "totalRev5YrAnnGrowth",
    	               "totalRevenue",
    	               "volume"  ];
    	var collections = {};
    	
    	$.each(data.companies, function(idx, company) {
    		
    		$.each(fields, function(dx, prop) {
        		if (!collections.hasOwnProperty(prop)) collections[prop] = new Array();
        		if (typeof company[prop] === "undefined" || company[prop] == 0) return;
        		collections[prop].push(company[prop]);
    		})
    		
    	});
    	
    	for (var prop in collections) {
    		console.log(prop);
    		var ret = collectStat(collections[prop]);
    		console.log(ret);
    	}

	}
	
	function error(data) {
		alert("You suck")
	}
	
	function collectStat(arr) {
		
		var buckets = {};

		// sort descending
		arr.sort(function(a, b) { return b-a; })

		// create at least 50 buckets
		$.each(arr, function(idx, val) { addToBucket(buckets, val); });
		
		return buckets;		
	}
	
	function addToBucket(buckets, val) {
		var midx = (Math.round(Math.log(val * 100000))%30);
		var idx = (Math.round(val * 100000)%30);
		if (!buckets.hasOwnProperty("mod")) {
			buckets.mod = {}
			buckets.mod[ midx ] = [];
			buckets.normal = {};
			buckets.normal[ idx ] = [];
		}
		buckets.mod[ midx ].push( val );
		buckets.normal[ idx ].push(val);
	}
	
    </script>    
    
</head>

<body>



</body>
</html>